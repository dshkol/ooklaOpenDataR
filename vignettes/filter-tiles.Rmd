---
title: "Filtering tiles to a specific area"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Filtering tiles to a specific area}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Setting up fixed performance data

The global dataset is helpful except when you aren't interested in dealing with global data. Often times, users have a specific area of interest in mind. 

```{r setup}
library(ooklaOpenDataR)
library(tmap)
library(sf)
library(tidyverse)
```

The city's open data portal has one boundary file we can use for filtering the tiles. 

```{r}
minneapolis <- read_sf("https://opendata.arcgis.com/datasets/89f1a70c0cf24d7692e2d02fdf8f4e47_0.geojson") %>%
  st_transform(4326) # transform to lat/lon
```

Then I'll download the fixed performance tiles for Q2 2020 and filter it with the Minneapolis boundary. `filter_by_quadkey()` uses a bounding box to efficiently filter the performance tiles from `get_performance_tiles()`.

```{r results = 'hide'}
mpls_fixed_tiles <- get_performance_tiles(service = "fixed", year = 2020, quarter = 2, sf = TRUE) %>%
  filter_by_quadkey(bbox = st_bbox(minneapolis))
```

